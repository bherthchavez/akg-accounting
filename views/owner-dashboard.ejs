<%- include('layout/header') %>

  <div class="page-wrapper">
    <!-- Page header -->
    <div class="page-header d-print-none">
      <div class="container-xl">
        <div class="row g-2 align-items-center">
          <div class="col">
            <!-- Page pre-title -->
            <div class="page-pretitle">Overview</div>
            <h2 class="page-title">Group Dashboard</h2>
          </div>
          <!-- Page title actions -->
         

        </div>
      </div>
    </div>

    <div class="page-body">
      <div class="container-xl">
        <div class="row ">

          <div class="col-lg-7">

            <div class="row">
              <div class="col-lg-6 mb-3">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex align-items-center">
                      <div class="subheader">Income</div>
                    </div>
                    <div class="d-flex align-items-baseline">
                      <div class="h1 mb-0 me-2">

                        <% if (vehicleFound !='' ) { %>
                          <% var sumOfIncome=0 %>
                            <% vehicleFound.forEach(function(vehicle){ %>
                              <% sumOfIncome +=+ vehicle.income %>
                                <% }) %>
                                  <%= (sumOfIncome).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,' ) %>
                                    <% } else { %>
                                      0.0
                                      <% } %>
                                        <span class="text-muted fs-h2 fw-normal">QAR</span>
                      </div>
                      <div class="me-auto">
                        <span class="text-green d-inline-flex align-items-center lh-1">
                          8%
                          <!-- Download SVG icon from http://tabler-icons.io/i/trending-up -->
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon ms-1" width="24" height="24"
                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <polyline points="3 17 9 11 13 15 21 7" />
                            <polyline points="14 7 21 7 21 14" />
                          </svg>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div id="chart-revenue-bg" class="chart-sm"></div>
                </div>
              </div>

              <div class="col-lg-6 mb-3">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex align-items-center">
                      <div class="subheader">Expenses</div>
                    </div>
                    <div class="d-flex align-items-baseline">
                      <div class="h1 mb-0 me-2">

                        <% if (vehicleFound !='' ) { %>
                          <% var sumOfExpenses=0 %>
                            <% vehicleFound.forEach(function(vehicle){ %>
                              <% sumOfExpenses +=+ vehicle.expenses %>
                                <% }) %>
                                  <%= (sumOfExpenses).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,' ) %>
                                    <% } else { %>
                                      0.0
                                      <% } %>
                                        <span class="text-muted fs-h2 fw-normal">QAR</span>
                      </div>
                      <div class="me-auto">
                        <span class="text-green d-inline-flex align-items-center lh-1">
                          8%
                          <!-- Download SVG icon from http://tabler-icons.io/i/trending-up -->
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon ms-1" width="24" height="24"
                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <polyline points="3 17 9 11 13 15 21 7" />
                            <polyline points="14 7 21 7 21 14" />
                          </svg>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div id="chart-expenses" class="chart-sm"></div>
                </div>
              </div>


            </div>

            <div class="col mb-3">
              <div class="card">
                <div class="card-body">
                  <div class="d-flex">
                    <h3 class="card-title">
                      <h3 class="text-success">Income</h3>
                      <h3 class="mx-2 text-muted">vs</h3>
                      <h3 class="text-warning">Expenses</h3>
                      <div class="ms-auto">
                        <h4 class="text-muted">Current Year - 2022</h4>
                      </div>
                  </div>
                  <div id="chart-tasks-overview"></div>
                </div>
              </div>
            </div>

          </div>

          <div class="col-lg-5 mb-3">

            <div class="col">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Companies</h3>
                </div>
                <div class="list-group list-group-flush overflow-auto" style="max-height: 35rem">
                  <% CompanyFound.forEach(function(company){ %>
                  <div class="list-group-item">
                    <div class="row">
                      <div class="col-auto">
                        <a href="#">
                          <span class="avatar fs-h6">LOGO</span>
                        </a>
                      </div>
                      <div class="col text-truncate align-self-center">
                        <a href="/company-dashboard/<%=company._id%>" class="text-body d-block fs-h2 fw-bold text-blue"><%=company.legal_name%></a>
                        <!-- <div class="text-muted text-truncate mt-n1 fs-h5">Change deprecated html tags to text decoration classes (#29604)</div> -->
                      </div>
                      <div class="col-auto align-self-center">
                        <a href="/company-dashboard/<%=company._id%>" class="btn fs-h5">
                          Go to Dashboard
                          <i class="ti ti-chevron-right fs-h3"></i>
                        </a>
                      </div>
                    </div>

                    <div class="row mt-2">
                      <div class="col-lg-6 col-md-12 col-sm-12 align-self-center">
                        <div class="card card-sm">
                          <div class="card-body">
                            <div class="row align-items-center">

                              <div class="col">

                                <div class="fw-bold fs-h4">
                                  <span class="text-muted fs-h5 fw-light">QAR</span>
                                  <% if (vehicleFound !='' ) { %>
                                    <% var sumOfIncome=0 %>
                                      <% vehicleFound.forEach(function(vehicle){ %>
                                        <% sumOfIncome +=+ vehicle.income %>
                                          <% }) %>
                                            <%= (sumOfIncome).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,' ) %>
                                              <% } else { %>
                                                0.0
                                                <% } %>
                                </div>
                                <div class="text-muted fs-h5">
                                  Total Income
                                </div>
                              </div>
                              <div class="col-auto">
                                <span class="bg-green-lt avatar fs-h2 ">
                                  <i class="ti ti-cash-banknote"></i>
                                </span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-lg-6 col-md-12 col-sm-12 align-self-center">
                        <div class="card card-sm">
                          <div class="card-body">
                            <div class="row align-items-center">
                              <div class="col">

                                <div class="fw-bold fs-h4">
                                  <span class="text-muted fs-h5 fw-light">QAR</span>
                                  <% if (vehicleFound !='' ) { %>
                                    <% var sumOfExpenses=0 %>
                                      <% vehicleFound.forEach(function(vehicle){ %>
                                        <% sumOfExpenses +=+ vehicle.expenses %>
                                          <% }) %>
                                            <%= (sumOfExpenses).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,' ) %>
                                              <% } else { %>
                                                0.0
                                                <% } %>
                                </div>
                                <div class="text-muted fs-h5">
                                  Total Expenses
                                </div>
                              </div>
                              <div class="col-auto">
                                <span class="bg-orange-lt avatar fs-h2 ">
                                  <i class="ti ti-cash-banknote"></i>
                                </span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <% }) %>

                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

  </div>

  <script>

    let dataExpenses = [];
    let [jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec] = Array(12).fill(0);

    ' <% if (invItems != "") { %>'

    '<%  invItems.forEach(function(item){ %>'

    var dMonth = new Date('<%=item.date%>').getMonth() + 1;

    if (dMonth === 1) {

      jan += + '<%=item.amount%>'

    } else if (dMonth === 2) {

      feb += + '<%=item.amount%>'

    } else if (dMonth === 3) {

      mar += + '<%=item.amount%>'

    } else if (dMonth === 4) {

      apr += + '<%=item.amount%>'

    } else if (dMonth === 5) {

      may += + '<%=item.amount%>'

    } else if (dMonth === 6) {

      jun += + '<%=item.amount%>'

    } else if (dMonth === 7) {

      jul += + '<%=item.amount%>'

    } else if (dMonth === 8) {

      aug += + '<%=item.amount%>'

    } else if (dMonth === 9) {

      sep += + '<%=item.amount%>'

    } else if (dMonth === 10) {

      oct += + '<%=item.amount%>'

    } else if (dMonth === 11) {

      nov += + '<%=item.amount%>'

    } else if (dMonth === 12) {

      dec += + '<%=item.amount%>'

    }

    ' <%  }) %>'
    ' <%  } %>'





    ' <% if (vouFound != "") { %>'

    let dataIncome = [];
    let [jan_, feb_, mar_, apr_, may_, jun_, jul_, aug_, sep_, oct_, nov_, dec_] = Array(12).fill(0);


    '<%  vouFound.forEach(function(item){ %>'

    var dMonth_ = new Date('<%=item.date%>').getMonth() + 1;

    if (dMonth_ === 1) {

      jan_ += + '<%=item.total_rent%>'

    } else if (dMonth_ === 2) {

      feb_ += + '<%=item.total_rent%>'

    } else if (dMonth_ === 3) {

      mar_ += + '<%=item.total_rent%>'

    } else if (dMonth_ === 4) {

      apr_ += + '<%=item.total_rent%>'

    } else if (dMonth_ === 5) {

      may_ += + '<%=item.total_rent%>'

    } else if (dMonth_ === 6) {

      jun_ += + '<%=item.total_rent%>'

    } else if (dMonth_ === 7) {

      jul_ += + '<%=item.total_rent%>'

    } else if (dMonth_ === 8) {

      aug_ += + '<%=item.total_rent%>'

    } else if (dMonth_ === 9) {

      sep_ += + '<%=item.total_rent%>'

    } else if (dMonth_ === 10) {

      oct_ += + '<%=item.total_rent%>'

    } else if (dMonth_ === 11) {

      nov_ += + '<%=item.total_rent%>'

    } else if (dMonth_ === 12) {

      dec_ += + '<%=item.total_rent%>'

    }

    ' <%  }) %>'
    ' <%  } %>'

    dataExpenses = [jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec];

    dataIncome = [jan_, feb_, mar_, apr_, may_, jun_, jul_, aug_, sep_, oct_, nov_, dec_];


    document.addEventListener("DOMContentLoaded", function () {
      window.ApexCharts && (new ApexCharts(document.getElementById('chart-tasks-overview'), {
        chart: {
          type: "line",
          dropShadow: {
            enabled: true,
            color: '#000',
            top: 18,
            left: 7,
            blur: 10,
            opacity: 0.3
          },
          fontFamily: 'inherit',
          height: 300,
          parentHeightOffset: 0,
          toolbar: {
            show: false,
          },
          animations: {
            enabled: true
          },

        },
        dataLabels: {
          enabled: true,
        },
        fill: {
          opacity: 1,
        },
        stroke: {
          width: 2,
          lineCap: "round",
          curve: "smooth",
        },
        series: [{
          name: "Total Income",
          data: dataIncome
        },
        {
          name: "Total Expenses",
          data: dataExpenses
        }],
        grid: {
          padding: {
            top: -20,
            right: 0,
            left: -4,
            bottom: -4
          },
          strokeDashArray: 4,
        },
        xaxis: {


          labels: {
            padding: 0,
          },
          tooltip: {
            enabled: true
          },
          axisBorder: {
            show: true,
          },


          categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
          title: {
            text: 'Month'
          },

        },

        yaxis: {
          title: {
            text: 'AMOUNT'
          },
          labels: {
            formatter: function (number) {
              var SI_SYMBOL = ["", "K", "M", "G", "T", "P", "E"];
              // what tier? (determines SI symbol)
              var tier = Math.log10(Math.abs(number)) / 3 | 0;

              // if zero, we don't need a suffix
              if (tier == 0) return number;

              // get suffix and determine scale
              var suffix = SI_SYMBOL[tier];
              var scale = Math.pow(10, tier * 3);

              // scale the number
              var scaled = number / scale;

              // format number and add suffix
              return scaled.toFixed(1) + suffix;
            }
          },
        },
        colors: ["#2fb344", "#f76707"],
        legend: {
          show: false,
        },
      })).render();
    });
       // @formatter:on
  </script>
  <script>
    // @formatter:off
    document.addEventListener("DOMContentLoaded", function () {
      window.ApexCharts && (new ApexCharts(document.getElementById('chart-revenue-bg'), {
        chart: {
          type: "area",
          fontFamily: 'inherit',
          height: 40.0,
          sparkline: {
            enabled: true
          },
          animations: {
            enabled: false
          },
        },
        dataLabels: {
          enabled: false,
        },
        fill: {
          opacity: .16,
          type: 'solid'
        },
        stroke: {
          width: 2,
          lineCap: "round",
          curve: "smooth",
        },
        series: [{
          name: "Profits",
          data: [37, 35, 44, 28, 36, 24, 65, 31, 37, 39, 62, 51, 35, 41, 35, 27, 93, 53, 61, 27, 54, 43, 19, 46, 39, 62, 51, 35, 41, 67]
        }],
        grid: {
          strokeDashArray: 4,
        },
        xaxis: {
          labels: {
            padding: 0,
          },
          tooltip: {
            enabled: false
          },
          axisBorder: {
            show: false,
          },
          type: 'datetime',
        },
        yaxis: {
          labels: {
            padding: 4
          },
        },
        labels: [
          '2020-06-20', '2020-06-21', '2020-06-22', '2020-06-23', '2020-06-24', '2020-06-25', '2020-06-26', '2020-06-27', '2020-06-28', '2020-06-29', '2020-06-30', '2020-07-01', '2020-07-02', '2020-07-03', '2020-07-04', '2020-07-05', '2020-07-06', '2020-07-07', '2020-07-08', '2020-07-09', '2020-07-10', '2020-07-11', '2020-07-12', '2020-07-13', '2020-07-14', '2020-07-15', '2020-07-16', '2020-07-17', '2020-07-18', '2020-07-19'
        ],
        colors: [tabler.getColor("green")],
        legend: {
          show: false,
        },
      })).render();
    });
    // @formatter:on
  </script>

  <script>
    // @formatter:off
    document.addEventListener("DOMContentLoaded", function () {
      window.ApexCharts && (new ApexCharts(document.getElementById('chart-expenses'), {
        chart: {
          type: "area",
          fontFamily: 'inherit',
          height: 40.0,
          sparkline: {
            enabled: true
          },
          animations: {
            enabled: false
          },
        },
        dataLabels: {
          enabled: false,
        },
        fill: {
          opacity: .16,
          type: 'solid'
        },
        stroke: {
          width: 2,
          lineCap: "round",
          curve: "smooth",
        },
        series: [{
          name: "Profits",
          data: [37, 35, 44, 28, 36, 24, 65, 31, 37, 39, 62, 51, 35, 41, 35, 27, 93, 53, 61, 27, 54, 43, 19, 46, 39, 62, 51, 35, 41, 67]
        }],
        grid: {
          strokeDashArray: 4,
        },
        xaxis: {
          labels: {
            padding: 0,
          },
          tooltip: {
            enabled: false
          },
          axisBorder: {
            show: false,
          },
          type: 'datetime',
        },
        yaxis: {
          labels: {
            padding: 4
          },
        },
        labels: [
          '2020-06-20', '2020-06-21', '2020-06-22', '2020-06-23', '2020-06-24', '2020-06-25', '2020-06-26', '2020-06-27', '2020-06-28', '2020-06-29', '2020-06-30', '2020-07-01', '2020-07-02', '2020-07-03', '2020-07-04', '2020-07-05', '2020-07-06', '2020-07-07', '2020-07-08', '2020-07-09', '2020-07-10', '2020-07-11', '2020-07-12', '2020-07-13', '2020-07-14', '2020-07-15', '2020-07-16', '2020-07-17', '2020-07-18', '2020-07-19'
        ],
        colors: [tabler.getColor("orange")],
        legend: {
          show: false,
        },
      })).render();
    });
  // @formatter:on
  </script>

  <%- include('layout/footer') %>